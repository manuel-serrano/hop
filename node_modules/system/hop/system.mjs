/*=====================================================================*/
/*    .../prgm/project/hop/hop/node_modules/system/lib/system.js       */
/*    -------------------------------------------------------------    */
/*    Author      :  Manuel Serrano                                    */
/*    Creation    :  Sun Jan 17 07:28:22 2021                          */
/*    Last change :  Fri Jan 21 17:58:18 2022 (serrano)                */
/*    Copyright   :  2021-22 Manuel Serrano                            */
/*    -------------------------------------------------------------    */
/*    Hop system functions                                             */
/*=====================================================================*/
"use hopscript"

/*---------------------------------------------------------------------*/
/*    Native implementation                                            */
/*---------------------------------------------------------------------*/
const _system = require("./_system.hop");

/*---------------------------------------------------------------------*/
/*    stringToCmd ...                                                  */
/*    -------------------------------------------------------------    */
/*    Split a string into a an of string.                              */
/*---------------------------------------------------------------------*/
function stringToCmd(cmd) {
   if (typeof cmd === "string") {
      return cmd
      	 .match(/([^ "']+)|"([^"]*)"|'([^']*)'|(?:[ \t]+)/g)
      	 .filter(s => !s.match(/^[ \t]+$/))
      	 .map(s => s[ 0 ] === "'" || s[ 0 ] === '"'
 	       	  ? s.substring(1, s.length - 1)
	       	  : s);
   } else {
      return cmd;
   }
}

/*---------------------------------------------------------------------*/
/*    system ...                                                       */
/*---------------------------------------------------------------------*/
export function system(cmd) {
   return new Promise((resolve, reject) => {
		_system.system(stringToCmd(cmd), resolve, reject);
	     });
}

/*---------------------------------------------------------------------*/
/*    systemSync ...                                                   */
/*---------------------------------------------------------------------*/
export function systemSync(cmd) {
   return _system.systemSync(stringToCmd(cmd));
}

/*---------------------------------------------------------------------*/
/*    exports                                                          */
/*---------------------------------------------------------------------*/
exports.system = system;
exports.systemSync = systemSync;
